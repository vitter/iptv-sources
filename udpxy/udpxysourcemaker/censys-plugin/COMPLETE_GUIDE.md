# 🎯 Censys UDPXY 提取器 - 完整使用指南

## 📝 项目概述

这是一个专为 Censys 平台设计的 Chrome 浏览器扩展，采用双模式架构，支持自动化提取 UDPXY 相关主机的 IP、端口等信息。通过在已登录的浏览器环境中运行，完全绕过 Cloudflare 和反自动化检测，适用于 IPTV/流媒体安全研究和数据收集。

## ✨ 主要特性

- **🔍 智能IP提取**: 从搜索结果自动识别和提取所有主机 IP 地址
- **🔌 端口数据提取**: 自动识别HTTP/HTTPS协议端口并生成CSV文件
- **🤖 双模式架构**: 搜索页面模式和主机详情页面模式，界面自适应切换
- **📊 多格式导出**: 支持 IP列表TXT、端口数据CSV、主机详情CSV 多种格式输出
- **🛡️ 反检测设计**: 在真实浏览器环境中运行，绕过所有检测机制
- **📈 实时统计**: 页面浮动按钮和插件界面均显示提取进度和结果统计
- **💾 数据持久化**: 本地缓存所有数据，关闭浏览器后不会丢失
- **🚀 自动收集**: 主机详情页支持自动收集模式，批量访问时自动保存数据

## 🛠️ 安装指南

### 1. 克隆或下载项目
```bash
git clone <repository_url>
cd censys-plugin
```

### 2. 在 Chrome 中加载扩展

#### 安装步骤：
1. **打开 Chrome 扩展管理页面**
   - 在地址栏输入: `chrome://extensions/`
   - 或通过菜单: **更多工具** → **扩展程序**

2. **启用开发者模式**
   - 点击右上角的 **开发者模式** 开关
   - 确保开关为蓝色(开启状态)

3. **加载扩展**
   - 点击 **加载已解压的扩展程序** 按钮
   - 选择 `censys-plugin` 文件夹
   - 点击 **选择文件夹**

4. **验证安装**
   - 扩展列表中应显示 **Censys UDPXY 提取器**
   - 状态应为 **已启用**
   - 浏览器工具栏出现蓝紫色渐变圆形图标

## 🎯 使用指南

### 准备工作
1. 访问 https://platform.censys.io
2. 使用你的账户正常登录
3. 确保可以正常访问搜索功能

### 🔍 推荐搜索语句
```
(host.services.software.product = "udpxy" or web.software.product = "udpxy") and host.location.country = "China"
```

### 📊 双模式功能详解

#### 模式一：搜索页面模式 🔍
- **适用页面**: https://platform.censys.io/search?q=...
- **页面识别**: 扩展自动检测搜索页面，右上角显示操作按钮
- **功能特性**:
  
  **IP列表提取**:
  1. 在 Censys 搜索页面执行搜索
  2. 点击页面右上角 **📋 提取IP列表** 按钮（或插件界面按钮）
  3. 自动从搜索结果提取所有主机IP地址
  4. 支持去重合并，可下载TXT格式文件
  
  **端口数据提取**:
  1. 在搜索结果页面点击 **🔌 提取端口数据** 按钮
  2. 自动识别每个主机的HTTP/HTTPS协议端口
  3. 生成CSV文件，格式为 `ip,ports`（多个端口用|分隔）
  4. 自动下载，文件名包含时间戳

#### 模式二：主机详情页面模式 🖥️
- **适用页面**: https://platform.censys.io/hosts/x.x.x.x
- **页面识别**: 扩展自动检测主机详情页，显示浮动操作面板
- **功能特性**:

  **自动收集模式**:
  1. 点击右上角状态指示器或插件界面 **🤖 自动收集模式** 按钮
  2. 启用后状态显示为 **🟢 自动收集已启用**
  3. 访问任意主机详情页面，3秒后自动收集数据
  4. 显示成功通知并更新统计数字
  
  **手动收集模式**:
  1. 在主机详情页点击 **📊 收集数据** 按钮
  2. 立即收集当前主机的完整信息
  3. 包括端口、地理位置、ISP、DNS等信息

### 🎨 页面UI元素

#### 搜索页面浮动按钮
- **位置**: 页面右上角
- **📋 提取IP列表**: 绿色渐变按钮，提取当前页面所有IP
- **🔌 提取端口数据**: 橙色渐变按钮，提取HTTP/HTTPS端口数据

#### 主机详情页面浮动面板
- **状态指示器**: 显示自动收集开关状态，可点击切换
- **📊 收集数据**: 蓝色按钮，手动收集当前主机数据
- **统计显示**: 实时显示已收集的主机数量

### 🚀 自动化工作流程

#### 批量数据收集推荐流程
1. **搜索阶段**: 在搜索页面使用 **🔌 提取端口数据** 获取IP和端口概览
2. **启用自动收集**: 在任一主机详情页启用自动收集模式
3. **批量访问**: 通过书签或脚本批量打开主机详情页
4. **自动保存**: 扩展自动收集每个页面的详细数据
5. **数据导出**: 在插件界面导出完整的CSV数据文件

## 📊 数据格式说明

### IP列表文件 (txt格式)
```
221.233.156.10
59.111.167.33
117.185.13.251
```

### 端口数据文件 (csv格式)
包含字段：ip, ports (多个端口用|分隔)
```csv
ip,ports
221.233.156.10,"80|446|8081|8082|8090|9000"
59.111.167.33,"80|8080"
117.185.13.251,"443|8443"
```

### 主机详情文件 (csv格式)
包含字段：ip, port, url, dns, country, city, province, isp
```csv
ip,port,url,dns,country,city,province,isp
221.233.156.10,8088,http://221.233.156.10:8088,example.com,China,Wuhan,Hubei,CHINANET-BACKBONE
```

## 🔧 故障排除

### ❌ 常见错误及解决方案

#### 1. "Could not establish connection. Receiving end does not exist."
这是最常见的错误，表示内容脚本没有正确加载或通信失败。

**解决步骤：**

1. **检查页面URL**
   - ✅ 确保在正确的Censys页面：`https://platform.censys.io/*`
   - ❌ 不要在 `censys.com` 主页或其他子域使用

2. **重新加载扩展**
   1. 打开 `chrome://extensions/`
   2. 找到 "Censys UDPXY Extractor"
   3. 点击 🔄 刷新按钮
   4. 确保扩展状态为 **已启用**

3. **刷新Censys页面**
   1. 在Censys页面按 `F5` 或 `Ctrl+R`
   2. 等待页面完全加载
   3. 重新尝试扩展功能

4. **检查开发者工具**
   1. 在Censys页面按 `F12` 打开开发者工具
   2. 切换到 **Console** 标签
   3. 查找 `[Censys Extractor]` 开头的日志
   4. 如果没有日志，说明内容脚本未加载

#### 2. "Please navigate to Censys search page first"
**解决方案：**
- ❌ 错误URL示例：`https://censys.com/`, `https://censys.io/`
- ✅ 正确URL示例：`https://platform.censys.io/search`, `https://platform.censys.io/hosts/`

#### 3. 扩展图标点击无反应
**检查清单：**
- [ ] 扩展是否正确安装？
- [ ] 开发者模式是否启用？
- [ ] 是否在支持的网站？

#### 4. 自动收集不工作
**解决方案：**
1. 确认自动收集模式已启用（绿色状态）
2. 确保在正确的主机详情页面
3. 等待页面完全加载（约3秒）
4. 检查控制台是否有错误信息

#### 5. 数据提取不完整
**解决方案：**
1. 确保网络连接稳定
2. 避免在页面加载期间操作
3. 如果遇到验证码，手动通过后继续
4. 检查Censys账户是否有访问限制

#### 6. 页面浮动按钮不显示
**解决方案：**
1. 刷新页面重新加载内容脚本
2. 检查页面URL是否正确
3. 在开发者工具Console中查看是否有脚本错误
4. 重新加载扩展后刷新页面

## 🎯 使用技巧

### 批量处理建议
1. **先收集概览**: 使用搜索页面的端口提取功能快速获取IP和端口概览
2. **启用自动收集**: 在主机详情页启用自动收集模式
3. **批量访问**: 通过书签或脚本批量打开主机详情页
4. **定期导出**: 避免数据丢失，定期导出CSV文件

### 性能优化
1. **控制并发**: 避免同时打开过多标签页
2. **清理缓存**: 定期清空扩展缓存释放内存
3. **分批处理**: 大量数据分批次处理，避免浏览器卡顿

### 安全建议
1. **合规使用**: 遵守Censys服务条款
2. **适度频率**: 避免过于频繁的请求
3. **账户安全**: 定期检查账户登录状态

## 🔍 技术实现

### 架构设计
- **popup.js**: 插件弹窗界面，负责用户交互和状态管理
- **content.js**: 内容脚本，负责页面数据提取和DOM操作
- **background.js**: 后台脚本，负责扩展生命周期和消息监听

### 数据提取机制
- **JSON解析**: 支持多种Censys平台JSON数据格式
- **DOM解析**: 从页面元素和链接中提取IP信息
- **协议过滤**: 精确匹配HTTP/HTTPS协议端口
- **递归搜索**: 深度遍历JSON对象结构

### 数据存储
- **本地缓存**: 使用Chrome存储API本地保存数据
- **持久化**: 关闭浏览器后数据不丢失
- **去重处理**: 自动去除重复IP和端口

## 📞 技术支持

如果遇到问题，请：
1. 检查本故障排除指南
2. 查看浏览器控制台错误信息
3. 确认扩展版本和浏览器版本
4. 提供详细的错误描述和复现步骤

## 🎯 适用场景

- **IPTV/流媒体安全研究**: 批量收集UDPXY服务器信息
- **资产发现与分析**: 自动化网络资产收集
- **安全研究**: 大规模主机数据分析
- **合规性检查**: 网络服务暴露面评估

---

**项目主页**: https://github.com/vitter/iptv-sources  
**问题反馈**: https://github.com/vitter/iptv-sources/issues

## 🛠️ 安装指南

### 1. 克隆或下载项目
```bash
git clone <repository_url>
cd censys-plugin
```

### 2. 在 Chrome 中加载扩展

#### 中文版安装步骤：
1. **打开 Chrome 扩展管理页面**
   - 在地址栏输入: `chrome://extensions/`
   - 或通过菜单: **更多工具** → **扩展程序**

2. **启用开发者模式**
   - 点击右上角的 **开发者模式** 开关
   - 确保开关为蓝色(开启状态)

3. **加载扩展**
   - 点击 **加载已解压的扩展程序** 按钮
   - 选择文件夹: `/home/vitter/github/iptv-sources/udpxy/udpxysourcemaker/censys-plugin`
   - 点击 **选择文件夹**

4. **验证安装**
   - 扩展列表中应显示 **Censys UDPXY 提取器**
   - 状态应为 **已启用**
   - 浏览器工具栏出现蓝紫色渐变圆形图标

## 🎯 使用指南

### 准备工作
1. 访问 https://platform.censys.io
2. 使用你的账户正常登录
3. 确保可以正常访问搜索功能

### 🔍 推荐搜索语句
```
(host.services.software.product = "udpxy" or web.software.product = "udpxy") and host.location.country = "China"
```

### 📊 四种提取模式

#### 模式一：搜索结果页面提取 🔍
- **适用页面**: https://platform.censys.io/search?q=...
- **功能**: 提取搜索结果中的所有IP地址
- **操作步骤**:
  1. 在 Censys 搜索页面执行搜索
  2. 点击扩展图标
  3. 点击 **📊 提取当前页面**
  4. 提取当前搜索结果页面的IP列表
  5. 点击 **💾 下载IP.txt** 保存IP列表

#### 模式二：端口数据提取 🔌
- **适用页面**: https://platform.censys.io/search?q=...
- **功能**: 提取IP地址的HTTP/HTTPS协议端口
- **操作步骤**:
  1. 在 Censys 搜索页面执行搜索
  2. 点击扩展图标
  3. 点击 **🔌 提取端口数据**
  4. 自动生成包含IP和端口的CSV文件并下载
- **CSV格式**: `ip,ports` (多个端口用|分隔)
- **示例**: `192.168.1.1,"80|8080|8088"`

#### 模式三：IP详情页面提取 🖥️
- **适用页面**: https://platform.censys.io/hosts/x.x.x.x
- **功能**: 提取主机的详细信息
- **操作步骤**:
  1. 点击搜索结果中的具体IP链接
  2. 进入详情页面
  3. 点击扩展图标
  4. 点击 **🔍 提取详情页面**
  5. 提取详细的JSON数据和元信息

#### 模式四：自动批量提取 🤖
- **位置**: 搜索页面
- **功能**: 自动执行多个查询的深度提取
- **操作**: 点击 **🤖 自动搜索提取**

### 🚀 真正自动化功能

#### 启用自动收集
**方式一：通过插件界面**
1. 在Censys主机页面点击扩展图标
2. 点击"🤖 自动收集模式"按钮
3. 按钮变为"🟢 自动收集已启用"

**方式二：通过页面按钮**
1. 在Censys主机页面找到右上角的状态指示器
2. 点击状态指示器切换自动收集模式
3. 状态从"🔴 自动收集已禁用"变为"🟢 自动收集已启用"

#### 自动收集工作流程
启用自动收集后：
1. 访问任意Censys主机详情页面
2. 页面加载完成3秒后自动开始收集
3. 显示成功通知："✅ 自动收集 [IP] 的数据完成"
4. 数据自动保存到缓存
5. 统计数字自动更新

### 🎨 页面UI元素

#### 主机详情页面
- **状态指示器**: 显示自动收集是否启用（绿色=启用，灰色=禁用）
- **收集按钮**: 手动收集当前主机数据
- **统计显示**: 实时显示已收集的主机数量

#### 搜索页面
- **提取IP按钮**: 从搜索结果中提取IP列表
- **提取端口按钮**: 从搜索结果中提取IP和HTTP/HTTPS端口数据

## 📊 数据格式说明

### IP列表文件 (txt格式)
```
221.233.156.10
59.111.167.33
117.185.13.251
```

### 端口数据文件 (csv格式)
包含字段：ip, ports (多个端口用|分隔)
```csv
ip,ports
221.233.156.10,"80|446|8081|8082|8090|9000"
59.111.167.33,"80|8080"
117.185.13.251,"443|8443"
```

### CSV数据文件 (主机详情)
包含字段：ip, port, url, dns, country, city, province, isp
```csv
ip,port,url,dns,country,city,province,isp
221.233.156.10,8088,http://221.233.156.10:8088,example.com,China,Beijing,Beijing,China Telecom
```

## 🔧 故障排除

### ❌ 常见错误及解决方案

#### 1. "Could not establish connection. Receiving end does not exist."
这是最常见的错误，表示内容脚本没有正确加载或通信失败。

**解决步骤：**

1. **检查页面URL**
   - ✅ 确保在正确的Censys页面：`https://platform.censys.io/*`
   - ❌ 不要在 `censys.com` 主页或其他子域使用

2. **重新加载扩展**
   1. 打开 `chrome://extensions/`
   2. 找到 "Censys UDPXY Extractor"
   3. 点击 🔄 刷新按钮
   4. 确保扩展状态为 **已启用**

3. **刷新Censys页面**
   1. 在Censys页面按 `F5` 或 `Ctrl+R`
   2. 等待页面完全加载
   3. 重新尝试扩展功能

4. **检查开发者工具**
   1. 在Censys页面按 `F12` 打开开发者工具
   2. 切换到 **Console** 标签
   3. 查找 `[Censys Extractor]` 开头的日志
   4. 如果没有日志，说明内容脚本未加载

5. **手动注入脚本**
   1. 点击扩展图标
   2. 如果看到 "🔄 Content script not ready. Injecting..."
   3. 等待自动注入完成
   4. 重新尝试功能

#### 2. "Please navigate to Censys search page first"
**解决方案：**
- ❌ 错误URL示例：`https://censys.com/`, `https://censys.io/`
- ✅ 正确URL示例：`https://platform.censys.io/search`, `https://platform.censys.io/hosts/`

#### 3. 扩展图标点击无反应
**检查清单：**
- [ ] 扩展是否正确安装？
- [ ] 开发者模式是否启用？
- [ ] 是否在支持的网站？

#### 4. 自动收集不工作
**解决方案：**
1. 确认自动收集模式已启用（绿色状态）
2. 确保在正确的主机详情页面
3. 等待页面完全加载（约3秒）
4. 检查控制台是否有错误信息

#### 5. 数据提取不完整
**解决方案：**
1. 确保网络连接稳定
2. 避免在页面加载期间操作
3. 如果遇到验证码，手动通过后继续
4. 检查Censys账户是否有访问限制

## 🎯 使用技巧

### 批量处理建议
1. **先收集IP列表**: 使用搜索页面模式快速获取目标IP
2. **批量访问详情**: 通过书签或脚本批量打开主机详情页
3. **启用自动收集**: 让扩展在后台自动收集数据
4. **定期导出**: 避免数据丢失，定期导出CSV文件

### 性能优化
1. **控制并发**: 避免同时打开过多标签页
2. **清理缓存**: 定期清空扩展缓存释放内存
3. **分批处理**: 大量数据分批次处理，避免浏览器卡顿

### 安全建议
1. **合规使用**: 遵守Censys服务条款
2. **适度频率**: 避免过于频繁的请求
3. **账户安全**: 定期检查账户登录状态

## 📞 技术支持

如果遇到问题，请：
1. 检查本故障排除指南
2. 查看浏览器控制台错误信息
3. 确认扩展版本和浏览器版本
4. 提供详细的错误描述和复现步骤

---

**项目主页**: https://github.com/vitter/iptv-sources  
**问题反馈**: https://github.com/vitter/iptv-sources/issues
